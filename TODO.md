# TODO

## 必須

- FIXME: 「Cb9」が「Cbの9」なのか「Cのb9」なのか分からず、強制的に前者扱いになってしまい、failしてしまう…どうしようかな。
  - これって世のコード表記自体の脆弱性なのでは？かっこをつけてるのかそういうのは…
  - 対策案としてはテンション部分は全部かっこで囲うルールにするとか…うーんでもそしたら「C(7)」とかになっちゃうけども…いいかな？うーん。C(5)
  - もしそうするなら、コードメタ情報は()で囲うのでなく[]で囲うように修正したほうがいいな。というかそれはもうやっちゃってもいいはず。紛らわしいので

- TODO: ExtensionにM7、M9、M11、M13を忘れてたわ。追加
  - これも「CM9」だと「CMの9th」なのか「CのM9」なのか区別つかなくなる問題あるな。
  - やっぱり前者を「CM(9)」、後者を「C（M9)」のようにかき分けるのが正義か…？なんかそう思えてきた
  - というかそういう仕様で提案したら？その方がExtensionをいくらでもつけれるよね？（C(-5,9,13)とか）
  - あと知恵袋に「CM9」の問題を聞いてみてもサンプリングにいいかもね

- ↑をやった後、配列にするやつを忘れずにやる。一旦()をつけるなどからやる
- エラーを全部網羅して実装してテストに組み込む
  - メタ情報が重複した時のエラーが不足しているので追加
- lib.rsにまとめる
- WebAssemblyにする最小のサンプルをGPTに聞いたりしてできるようにする
  - `wasm-bindgen`を使うとd.tsも出力してくれるっぽいけど古い？

## 仕様面

- なんかよく分かってないからか動作が重くなった気がする
  - cloneってパフォーマンス上の劣化があるっぽい
- 不正な入力へのテストをたくさん
  - エスケープとか対応するならする

## コード品質面

- コメント追加
- 関数に切り出し
- prettifyされない。動かなくなってるかも
- exhaustive match
- errors、「the xx is not yy」のような動的なエラーメッセージに対応できないっぽいので修正する必要がありそう。ただしエラーIDも持ちたい。idと、stringを返す関数で作るしかない？
- 全エラーケースに対する自動テスト
- strumを使ってmatchを簡単にする
- unwrap()多すぎ問題。panic起こるので適切にハンドリングする
  - unwrap()の代わりにif let で書き換える
- PartialEqとかDebugとかのderiveの値は何なのか
- chord_detailed.rs、extension周りのコードが汚いので修正したい
- is_token_char、Token::VARIANTSを使って書き換える

## できれば系

- `-5`と`b5`を同じものと扱うのはstrumの技術的に一旦諦めたので、後で対応する。今は一旦`b5`のみ対応
  - strumやめて独自で管理すれば一応は対応可能なはず
    - 例えば単に以下のようなオブジェクトの配列にするとかね
      {
        name: "FlatFive",
        aliases: ["-5", "b5"],
        intervals: [-5],
      }
