# TODO

## 必須

- meta_info、`"section": {value: "..."}` のような構造になってるけど`{type:"...", value:"..."}`のほうがよいと思うので検討
- エラーを全部網羅して実装してテストに組み込む
  - メタ情報が重複した時のエラーが不足しているので追加
- WebAssemblyにする最小のサンプルをGPTに聞いたりしてできるようにする
  - `wasm-bindgen`を使うとd.tsも出力してくれるっぽいけど古い？
  - TSの型も自動生成したい
    - sectionが`Array<Array>`のようになっていた。どうしよう。rs_tsに合わせて構造変えるのもな…rustのtypeをtsのtypeにしてくれないしうーん。色々試したけどきついっぽかった。
    - `https://github.com/oscartbeaumont/specta`使っちゃったほうがいいのかも
    - 最悪自分でツール作る。
    - 無理なら`types.d.ts`を手書きするしかない。一応型の自動テストもできるはず

## 仕様面

- なんかよく分かってないからか動作が重くなった気がする
  - cloneってパフォーマンス上の劣化があるっぽい
- 不正な入力へのテストをたくさん
  - エスケープとか対応するならする

## コード品質面

- `自動テスト`
  - できればTSでコード進行ジェネレータを作って、テストに使う
  - あえて変な値を作るジェネレータも作ってテストする
    - ただこれはユニットテストで済ませたほうが良いと思う
  - 全エラーケースに対する自動テスト
- `rust知識系`
  - exhaustive match
  - unwrap()多すぎ問題。panic起こるので適切にハンドリングする
    - unwrap()の代わりにif let で書き換える
  - PartialEqとかDebugとかのderiveの値は何なのか
- `他`
  - まだstrum使ってない箇所あるので使う（Accidentalとか）
  - コメント追加
  - 関数に切り出し
  - prettifyされない。動かなくなってるかも
  - errors、「the xx is not yy」のような動的なエラーメッセージに対応できないっぽいので修正する必要がありそう。ただしエラーIDも持ちたい。idと、stringを返す関数で作るしかない？
    - relay-compilerのようなコードが参考になるかも
  - chord_detailed.rs、extension周りのコードが汚いので修正したい
  - is_token_char、Token::VARIANTSを使って書き換える

## 他

- コミットメッセージやソースコードに日本語を混ぜられないようにする

## 後に改善系

- `-5`と`b5`を同じものと扱うのはstrumの技術的に一旦諦めたので、後で対応する。今は一旦`b5`のみ対応
  - strumやめて独自で管理すれば一応は対応可能なはず
    - 例えば単に以下のようなオブジェクトの配列にするとかね
      {
        name: "FlatFive",
        aliases: ["-5", "b5"],
        intervals: [-5],
      }
